---
type: rule
title: Do you secure your wireless connection?
uri: do-you-secure-your-wireless-connection
created: 2017-07-10T21:37:12.0000000Z
authors:
- id: 47
  title: Stanley Sidik

---



<span class='intro'> <p>Wireless networks are everywhere now. You can't drive down the street without finding a network which is&#160;insecure. However, in an office&#160;environment, there is a lot more to lose than a bit of bandwidth. It is vital that wireless is kept secure.​<br><br></p> </span>

<p class="ssw15-rteElement-GreyBox">WEP, No SSID broadcast, allowed MAC addresses are all OK but these are more home security.</p><dd class="ssw15-rteElement-FigureBad">Figure&#58; Bad example - the above settings are not suitable for a company's wireless access point<br></dd><div> 
   <br> 
</div><p>For the office, you need something a bit more robust and not requiring much management overhead. <br></p><p class="ssw15-rteElement-GreyBox">It is recommended to use Radius authentication to integrate with your Active Directory.<br></p><div><dd class="ssw15-rteElement-FigureGood">Figure&#58; Good example - configure your wireless access point to authenticate against AD</dd><p>This article explains how to setup your wireless AP to use WPA2-enterprise. WPA2-Enterprise verifies network users (AD a/c's) through a server (Domain Controller).</p><p>The recommended method of authentication is PEAP (Protected Extensible Authentication Protocol), which authenticates wireless LAN clients using only server-side digital certificates (In our case we used an AD CA) by creating an encrypted SSL/TLS tunnel between the client and the authentication server. The tunnel then protects the subsequent user authentication exchange. <br></p><h4>Requirements&#58;</h4><ul><li>802.1X-capable 802.11 wireless access points (APs)</li><li>Active Directory with group policy</li><li>Network Policy Server (NPS) servers</li><li>Active Directory Certificate Services based PKI for Server certificates for NPS computer/s and your wireless PC's</li></ul><h4>Assumptions&#58;</h4><p>This document assumes you have some knowledge of how to configure your wireless access points and install server roles. It also assumes that you have already configured an Enterprise Certificate&#160;Authority&#160;on your Active Directory Domain.</p><ol><li>
         <strong>Configure your wireless access points</strong></li><p>In SSW we use Unifi APs. I have configured these access points&#160;to&#58;</p><p><img src="ubntuap-ac-lite.jpg" alt="ubntuap-ac-lite.jpg" style="margin&#58;5px;width&#58;300px;height&#58;300px;" /><br></p><dl class="image"><dt>  </dt><dd>Figure&#58;&#160;Unifi AP</dd></dl><ol><li>Broadcast the SSID</li><li>Use AES-CCM Cipher for encryption</li><li>Use WPA2 (mandatory)</li><li>Use the native&#160;VLAN</li><li>Configure a shared secret that you will use with the NPS Radius server</li></ol><p>Recommend using WPA2-EAP with AES as your encryption cipher.</p><li>
         <strong>Install NPS on your server</strong></li><p>On Windows 2008 or 2008 R2 open up the server manager and&#58;</p><ol><li>Add the &quot;Network Policy and Access Services&quot; Role</li></ol><p>Under role services add&#58;</p><ul><li>Network Policy Server</li><li>Routing and Remote Access Services</li></ul><li>
         <strong>Configure Radius Clients on NPS</strong></li><p>Open up the NPS Console. Right click on &quot;Radius Clients&quot;, and then click on &quot;New&quot;.</p><p>Fill out the fields for Friendly Name (enter the name&#160;of the wireless&#160;access point), Address (IP address) and then add the shared secret (Keep this safe for example we use Keepass as a password repository) you configure on your access point.</p><dl class="image"><dt> <img src="NPS2.png" alt="Radius client settings " style="width&#58;350px;height&#58;445px;" /> <br> 
         </dt><dd>Figure&#58; Radius client settings</dd></dl><li>
         <strong>Configure 802.1x on the NPS server</strong></li><p>In the NAP servers Server Manager, open &quot;Roles&quot;, then &quot;Network Policy and Access Services&quot; then click on NPS (Local).</p><p>In the&#160;right-hand&#160;pane under standard configuration choose &quot;Radius Server for 802.1x Wireless or Wired Connections&quot;, and then click on &quot;Configure 802.1X&quot; to start a&#160;wizard-based&#160;configuration.</p><ol><li>Select the top radio button “Secure Wireless Connections&quot; click next</li><li>On the Specify&#160;802.1X&#160;Switches Page check the AP's you have configured under Radius Clients are in that list then click next</li><li>Now the authentication method. From the Drop Down lists select Protected EAP (PEAP)<br><strong>NOTE&#58;</strong>&#160;This method requires a Computer Certificate and the Radius Server and either a computer or user certificate on the client machine</li><li>Select the groups (eg. Domain\WirelessAccess) you would like to give wireless access to. You can do this by user or computer or both</li><li>If you need to configure VLan's in the next step, wasn't required in my case I just used the defaults</li><li>You then need to register the server with Active Directory. So right click on NPS (local) and select Register Server in Active Directory<br></li><dl class="image"><dt><img src="NPS.png" alt="How to register NAP server with AD" style="width&#58;550px;height&#58;389px;" /></dt><dd>Figure&#58; How to register NAP server with AD</dd></dl>
      </ol><p>You should now have a Connection Request&#160;Policy and a Network Policy. Remove the MS-CHAP v1 authentication method from the network policy (under the constraint's tab).</p><li>​ <strong>Configure Certificate Auto enrolment</strong></li><p>First open Group Policy Management.</p><ol><li>Create a new GPO policy and name it &quot;Cert_Enrollment_Wireless&quot; or whatever name you deem suitable and link it to the root of the domain or a specific OU depending on your needs and OU structure</li><li>Under the security filtering scope for what the policy gets applied to remove &quot;Authenticated Users&quot; and add your AD created. This ensures that the policy, once configured, is applied only to members of those groups.</li><li>Edit the settings of the group policy and go to&#58;</li><ol><li>Computer Configuration\Policies\Windows Settings\Security Settings\Public Key Policies</li><p>In the details&#160;pane, you need to&#160;right-click&#160;the Certificate Services Client –&#160;Auto-enrolment&#160;and then select properties.</p><p>In the&#160;Properties, dialog box select enabled from the drop down box and then place a tick in all the remaining tick boxes. This makes sure that the computer&#160;auto-enrolls&#160;for a certificate from AD CA.</p><li>Now navigate to Computer Configuration\Policies\Windows Settings\Security Settings\Public Key Policies\Automatic Certificate Request Settings</li><p>Right-click in the details pane and select New | Automatic Certificate Request.</p><p>This will open up a wizard and you can select a Computer Certificate.</p><dl class="image"><dt> <img src="Cert4.png" alt="Group policy settings " style="width&#58;600px;height&#58;362px;" /> </dt><dd>Figure&#58; Group policy settings</dd></dl></ol></ol><li>
         <strong>Creating a Vista (or XP) Wireless 802.1x GPO Policy (Vista policy works with Windows 7 &amp; 8)</strong></li><ol><li>Now go to Computer Configuration\Policies\Windows Settings\Security Settings\Wireless Network (IEEE 802.11) Policies</li><p>Right click and Create a new policy for Windows Vista and later (if you only have XP machines, do only an XP one). If you have Vista you must do a Vista policy or else Vista will try to use the XP policy (not recommended).</p><li>Enter a&#160;Policy&#160;Name (e.g. Beijing_Wifi_Settings) and description and link to the root of the domain.</li><dl class="image"><dt> <img src="Cert3.png" alt="GP link and scope settings" style="width&#58;600px;height&#58;365px;" /> </dt><dd>Figure&#58; GP link and scope settings</dd></dl><li>Click &quot;Add&quot; and then enter a Profile Name and then Add the SSID name from the Wireless Access Point/s. Make sure the tick box &quot;Connect Automatically when this network is in range&quot; is ticked...</li><li>Click on the Security Tab</li><p>Make sure Authentication is &quot;WPA2-Enterprise&quot; and Encryption is &quot;AES).</p><p>Under &quot;Select a network authentication method, choose &quot;Microsoft&#58; Protected EAP (PEAP).</p><p>Under Authentication&#160;Mode, you need to choose whether you want to authenticate computers and/or users with your digital certs. Then select &quot;Computer Authentication&quot;.</p><li>Click on the &quot;Properties&quot; button</li><p>Tick &quot;Validate server certificate&quot; and then tick &quot;Connect to these servers&quot;. Enter the FQDN of the NPS.</p><p>Then under Trusted Root Certification Authority, tick your Root CA certificate. Then click OK.<br></p><dl class="image"><dt> <img src="Cert2.png" alt="Connection security settings" style="width&#58;600px;height&#58;428px;" /> </dt><dd>Figure&#58; Connection security settings</dd></dl><li>Click OK twice.</li><p>
            <strong>Optional&#58;&#160;</strong>Under Network Permission tab you can use the tick boxes to restrict clients to infrastructure networks or only GPO profiled allowed networks if you desire.</p><li>Click OK and you have completed your Vista Wireless Policy</li><dl class="image"><dt> <img src="GPU.png" alt="Wifi_Settings settings" style="width&#58;600px;height&#58;632px;" /> </dt><dd>Figure&#58; Wifi_Settings settings</dd></dl></ol></ol></div>


